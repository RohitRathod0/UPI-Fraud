<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SecureUPI • Fraud Detection Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f5f7ff;
    --card:#ffffff;
    --ink:#22252e;
    --muted:#6b7280;
    --brand:#5b6ee1;
    --brand-2:#7c4bd8;
    --ok:#17a773;
    --warn:#f59e0b;
    --block:#ef4444;
    --stroke:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:linear-gradient(135deg,#5b6ee11a,#7c4bd81a),var(--bg);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--ink);
  }
  .shell{display:grid;grid-template-columns:280px 1fr;min-height:100vh;}
  .nav{
    background:linear-gradient(180deg,#5b6ee1,#7c4bd8);
    color:#fff;padding:24px;
  }
  .brand{
    display:flex;align-items:center;gap:12px;margin-bottom:24px;
  }
  .brand-badge{
    width:40px;height:40px;border-radius:12px;background:rgba(255,255,255,.18);
    display:grid;place-items:center;font-weight:900;
  }
  .nav .hint{font-size:12px;opacity:.85;line-height:1.5}
  .nav .menu{margin-top:20px;display:flex;flex-direction:column;gap:10px}
  .nav .menu .item{
    padding:10px 12px;border-radius:10px;cursor:default;background:rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.18);font-weight:600;font-size:14px;
  }
  .main{padding:24px;display:grid;grid-template-rows:auto 1fr;gap:16px;}
  .bar{
    background:var(--card);border:1px solid var(--stroke);border-radius:14px;padding:16px 18px;
    display:flex;align-items:center;justify-content:space-between;
  }
  .bar .title{font-weight:800}
  .bar .meta{color:var(--muted);font-size:13px}
  .grid{
    display:grid;grid-template-columns:520px 1fr;gap:16px;
  }
  .card{
    background:var(--card);border:1px solid var(--stroke);border-radius:14px;padding:18px;
  }
  .section-title{font-size:15px;font-weight:800;margin-bottom:12px}
  .form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .field{display:flex;flex-direction:column;gap:8px}
  .field.full{grid-column:1/-1}
  .label{font-size:12px;font-weight:700;color:var(--muted);letter-spacing:.02em}
  .input, .select, .textarea{
    width:100%;font:inherit;border:1.5px solid var(--stroke);border-radius:10px;padding:12px 12px;
    outline:none;transition:.15s;background:#fff;
  }
  .input:focus, .select:focus, .textarea:focus{
    border-color:var(--brand);box-shadow:0 0 0 4px rgba(91,110,225,.12);
  }
  .textarea{min-height:92px;resize:vertical}
  .actions{display:flex;gap:10px;margin-top:6px}
  .btn{
    border:none;border-radius:10px;padding:12px 14px;font-weight:800;cursor:pointer;
    display:inline-flex;align-items:center;gap:8px
  }
  .btn-primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff}
  .btn-muted{background:#fff;border:1px solid var(--stroke);color:var(--ink)}
  .kpi{
    display:flex;align-items:center;gap:12px;margin-bottom:10px
  }
  .pill{
    padding:6px 10px;border-radius:999px;font-weight:800;font-size:12px;color:#fff;display:inline-block
  }
  .pill-ok{background:var(--ok)}
  .pill-warn{background:var(--warn)}
  .pill-block{background:var(--block)}
  .subgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .subscore{border:1px solid var(--stroke);border-radius:12px;padding:12px}
  .bar-wrap{height:8px;background:#f1f5f9;border-radius:999px;overflow:hidden;margin-top:8px}
  .bar-fill{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:.4s}
  .list{font-size:13px;color:var(--ink);line-height:1.55;white-space:pre-wrap}
  .json{
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size:12px;background:#0b1220;color:#d2e1ff;border-radius:12px;padding:12px;overflow:auto;max-height:260px
  }
  .table{width:100%;border-collapse:collapse;font-size:13px}
  .table th,.table td{border-bottom:1px solid var(--stroke);padding:10px 6px;text-align:left}
  .badge{display:inline-block;font-size:11px;font-weight:800;border-radius:999px;padding:3px 8px}
  .badge-pay{background:#eef2ff;color:#3730a3}
  .badge-qr{background:#ecfeff;color:#155e75}
  .badge-collect{background:#fef3c7;color:#92400e}
</style>
</head>
<body>
<div class="shell">
  <aside class="nav">
    <div class="brand">
      <div class="brand-badge">₹</div>
      <div>
        <div style="font-size:18px;font-weight:900">SecureUPI</div>
        <div style="font-size:12px;opacity:.9">AI‑Protected Payments</div>
      </div>
    </div>
    <div class="hint">Proof‑of‑Concept dashboard that mimics a UPI payment flow and showcases real‑time fraud detection, trust scores, and actions (ALLOW/WARN/BLOCK/HUMAN_REVIEW).</div>
    <div class="menu">
      <div class="item">Payment</div>
      <div class="item">Trust & Agents</div>
      <div class="item">Review Queue</div>
    </div>
  </aside>

  <main class="main">
    <div class="bar">
      <div>
        <div class="title">Payment • Fraud Detection</div>
        <div class="meta">Enter details, run AI Security Check, and view trust score & reasons instantly.</div>
      </div>
      <div class="meta" id="health">Server: checking…</div>
    </div>

    <div class="grid">
      <!-- Left: Payment form -->
      <div class="card">
        <div class="section-title">Transaction Details</div>
        <div class="form">
          <div class="field">
            <label class="label">Payer UPI ID</label>
            <input class="input" id="payer_vpa" placeholder="vikas@paytm" value="vikas@paytm">
          </div>
          <div class="field">
            <label class="label">Payee UPI ID</label>
            <input class="input" id="payee_vpa" placeholder="vansh@upi" value="vansh@upi">
          </div>
          <div class="field">
            <label class="label">Mobile Number</label>
            <input class="input" id="mobile_number" placeholder="98XXXXXXXX" maxlength="10">
          </div>
          <div class="field">
            <label class="label">Amount (₹)</label>
            <input class="input" id="amount" type="number" placeholder="8000" value="8000" min="1">
          </div>
          <div class="field">
            <label class="label">Transaction Type</label>
            <select class="select" id="transaction_type">
              <option value="pay" selected>pay</option>
              <option value="qr_pay">qr_pay</option>
              <option value="collect">collect</option>
            </select>
          </div>
          <div class="field full">
            <label class="label">Message / Note *</label>
            <textarea class="textarea" id="message" placeholder="URGENT! Account locked. Verify PIN at http://fake-bank-verify.com">URGENT! Account locked. Verify PIN at http://fake-bank-verify.com</textarea>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" id="runBtn">Run AI Security Check</button>
          <button class="btn btn-muted" id="safeBtn">Load Safe Example</button>
          <button class="btn btn-muted" id="phishBtn">Load Phishing</button>
          <button class="btn btn-muted" id="qrBtn">Load QR Scam</button>
          <button class="btn btn-muted" id="collectBtn">Load Collect Threat</button>
        </div>

        <div style="margin-top:10px">
          <div class="section-title">Request JSON</div>
          <pre class="json" id="reqJson">{}</pre>
        </div>
      </div>

      <!-- Right: Results -->
      <div class="card">
        <div class="section-title">Results</div>

        <div class="kpi">
          <div style="font-weight:900;font-size:40px" id="trust">—</div>
          <div id="actionPill" class="pill pill-ok">Action: —</div>
        </div>

        <div class="subgrid">
          <div class="subscore">
            <div style="font-weight:800;font-size:13px">Phishing</div>
            <div class="bar-wrap"><div id="bar-phish" class="bar-fill"></div></div>
          </div>
          <div class="subscore">
            <div style="font-weight:800;font-size:13px">Quishing</div>
            <div class="bar-wrap"><div id="bar-qr" class="bar-fill"></div></div>
          </div>
          <div class="subscore">
            <div style="font-weight:800;font-size:13px">Collect Fraud</div>
            <div class="bar-wrap"><div id="bar-collect" class="bar-fill"></div></div>
          </div>
          <div class="subscore">
            <div style="font-weight:800;font-size:13px">Malware</div>
            <div class="bar-wrap"><div id="bar-mal" class="bar-fill"></div></div>
          </div>
        </div>

        <div style="margin-top:16px">
          <div class="section-title">Reasons</div>
          <div id="reasons" class="list">—</div>
        </div>

        <div style="margin-top:12px">
          <div class="section-title">Response JSON</div>
          <pre class="json" id="resJson">{}</pre>
        </div>
      </div>
    </div>

    <!-- Recent transactions (optional static demo) -->
    <div class="card">
      <div class="section-title">Recent Transactions (Demo)</div>
      <table class="table">
        <thead>
          <tr><th>Txn ID</th><th>Payee</th><th>Type</th><th>Amount</th><th>Action</th><th>Trust</th></tr>
        </thead>
        <tbody id="recent">
          <tr><td>TXN-101</td><td>verify-security@upi</td><td><span class="badge badge-pay">pay</span></td><td>₹ 15,000</td><td>BLOCK</td><td>28</td></tr>
          <tr><td>TXN-102</td><td>prize-claim@paytm</td><td><span class="badge badge-qr">qr_pay</span></td><td>₹ 19,999</td><td>WARN</td><td>42</td></tr>
          <tr><td>TXN-103</td><td>grocery-store@paytm</td><td><span class="badge badge-pay">pay</span></td><td>₹ 450</td><td>ALLOW</td><td>96</td></tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<script>
  // 1) Point to your API
  const API_URL = (location.hostname === '127.0.0.1' || location.hostname === 'localhost')
      ? 'http://127.0.0.1:8000/api/v1/score_request'
      : '/api/v1/score_request';

  // 2) Health hint
  fetch('/health').then(r=>r.json()).then(j=>{
    const a=j.agents||{};
    document.getElementById('health').innerText =
      `Server OK • Agents: Phishing ${a.phishing?'✓':'×'}, Quishing ${a.quishing?'✓':'×'}, Collect ${a.collect_request?'✓':'×'}, Malware ${a.malware?'✓':'×'}`;
  }).catch(()=>{document.getElementById('health').innerText='Server: unreachable'});

  // Helpers
  const qs = id => document.getElementById(id);
  const setBar = (id, p) => { qs(id).style.width = Math.max(0, Math.min(100, p)) + '%'; };
  const setPill = (action) => {
    const pill = qs('actionPill');
    pill.textContent = `Action: ${action}`;
    pill.className = 'pill ' + (action==='ALLOW'?'pill-ok':action==='WARN'?'pill-warn':'pill-block');
  };

  const fillExample = (which) => {
    const map = {
      safe: {
        payer_vpa:'vikas@paytm', payee_vpa:'grocery-store@paytm', amount:450, mobile_number:'9876543210',
        transaction_type:'pay', message:'Weekly groceries'
      },
      phishing: {
        payer_vpa:'vikas@paytm', payee_vpa:'verify-security@upi', amount:15000, mobile_number:'9876543210',
        transaction_type:'pay', message:'URGENT! Account locked. Verify PIN at http://fake-bank.com'
      },
      qr: {
        payer_vpa:'vikas@paytm', payee_vpa:'prize-claim@paytm', amount:19999, mobile_number:'9876543210',
        transaction_type:'qr_pay', message:'Scan QR to claim ₹50,000 prize at http://bit.ly/win'
      },
      collect: {
        payer_vpa:'vikas@paytm', payee_vpa:'legal-dept@upi', amount:12000, mobile_number:'9876543210',
        transaction_type:'collect', message:'FINAL NOTICE: Pay dues immediately or face legal action'
      }
    }[which];
    Object.entries(map).forEach(([k,v])=>{
      if(qs(k)) qs(k).value = v;
    });
  };

  // UI events
  qs('safeBtn').onclick = ()=>fillExample('safe');
  qs('phishBtn').onclick = ()=>fillExample('phishing');
  qs('qrBtn').onclick = ()=>fillExample('qr');
  qs('collectBtn').onclick = ()=>fillExample('collect');

  qs('runBtn').onclick = async () => {
    const payload = {
      transaction_id: 'TXN-' + Date.now(),
      payer_vpa: qs('payer_vpa').value.trim(),
      payee_vpa: qs('payee_vpa').value.trim(),
      mobile_number: qs('mobile_number').value.trim() || null,
      amount: parseFloat(qs('amount').value),
      message: qs('message').value.trim(),
      transaction_type: qs('transaction_type').value,
      payee_new: 1
    };

    if(!payload.payer_vpa || !payload.payee_vpa || !payload.amount || !payload.message){
      alert('Please fill all required fields'); return;
    }
    if(payload.mobile_number && !/^[6-9][0-9]{9}$/.test(payload.mobile_number)){
      alert('Enter a valid 10‑digit Indian mobile number'); return;
    }

    qs('reqJson').textContent = JSON.stringify(payload, null, 2);

    try{
      const res = await fetch(API_URL, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      qs('resJson').textContent = JSON.stringify(data, null, 2);

      // Update KPIs
      qs('trust').textContent = data.trust_score ?? '—';
      setPill(data.action || '—');

      // Subscores (0..1 → percent)
      const s = data.subscores || {};
      setBar('bar-phish',  (s.phishing ?? 0) * 100);
      setBar('bar-qr',     (s.quishing ?? 0) * 100);
      setBar('bar-collect',(s.collect  ?? 0) * 100);
      setBar('bar-mal',    (s.malware  ?? 0) * 100);

      // Reasons
      const reasons = (data.reasons || []).map((r)=>`• ${r}`).join('\n');
      qs('reasons').textContent = reasons || '—';

    }catch(err){
      qs('resJson').textContent = JSON.stringify({ error: String(err) }, null, 2);
      alert('Request failed. Check server and console.');
    }
  };
</script>
</body>
</html>
